<!DOCTYPE html>
<html lang="zh-cn">
 <head> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
  <title>linux openvpn 安装小记 - Wayde-p - 博客园</title> 
  <link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=m_FXmwz3wxZoecUwNEK23PAzc-j9vbX_C6MblJ5ouMc1" /> 
  <link id="MainCss" type="text/css" rel="stylesheet" href="/skins/iMetro_HD/bundle-iMetro_HD.css?v=LB0Nt-WUQuLcxcyW_sZ5y1ZtDWL9LKn4F39H-3pjDYs1" /> 
  <link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="/skins/iMetro_HD/bundle-iMetro_HD-mobile.css?v=-7sMIzZKEphXQAbLyVlaoCblefduSvrHuU0QSPF5Zrc1" /> 
  <link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/wayde-Z/rss" /> 
  <link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/wayde-Z/rsd.xml" /> 
  <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/wayde-Z/wlwmanifest.xml" /> 
  <script src="//common.cnblogs.com/script/jquery.js" type="text/javascript"></script> 
  <script type="text/javascript">var currentBlogApp = 'wayde-Z', cb_enable_mathjax=false;var isLogined=false;</script> 
  <script src="/bundles/blog-common.js?v=HjE8xh24aOra0V_HP38wxIHV3lfHC5polwLAK3mmjdg1" type="text/javascript"></script> 
 </head> 
 <body> 
  <a name="top"></a> 
  <!--done--> 
  <div id="home"> 
   <div id="header"> 
    <div id="blogTitle"> 
     <a id="lnkBlogLogo" href="http://www.cnblogs.com/wayde-Z/"><img id="blogLogo" src="/Skins/custom/images/logo.gif" alt="返回主页" /></a> 
     <!--done--> 
     <h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/wayde-Z/">Wayde-p</a></h1> 
     <h2></h2> 
    </div>
    <!--end: blogTitle 博客的标题和副标题 --> 
    <div id="navigator"> 
     <ul id="navList"> 
      <li><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li> 
      <li><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/wayde-Z/">首页</a></li> 
      <li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li> 
      <li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Wayde-p">联系</a></li> 
      <li><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/wayde-Z/rss">订阅</a> 
       <!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/wayde-Z/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li> 
      <li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li> 
     </ul> 
     <div class="blogStats"> 
      <div id="blog_stats"> 
       <span id="stats_post_count">随笔 - 20&nbsp; </span> 
       <span id="stats_article_count">文章 - 0&nbsp; </span> 
       <span id="stats-comment_count">评论 - 0</span> 
      </div> 
     </div>
     <!--end: blogStats --> 
    </div>
    <!--end: navigator 博客导航栏 --> 
   </div>
   <!--end: header 头部 --> 
   <div id="main"> 
    <div id="mainContent"> 
     <div class="forFlow"> 
      <div id="post_detail"> 
       <!--done--> 
       <div id="topics"> 
        <div class="post"> 
         <h1 class="postTitle"> <a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/wayde-Z/p/6558159.html">linux openvpn 安装小记</a> </h1> 
         <div class="clear"></div> 
         <div class="postBody"> 
          <div id="cnblogs_post_body">
           <h1><a name="_Toc333079238"></a>一 VPN基础讲解</h1> 
           <h4><a name="_Toc333079239"></a>1.1什么是VPN</h4> 
           <p>IP机制仿真出一个私有的广域网&quot;是通过私有的隧道技术在公共数据网络上仿真一条点到点的专线技术。所谓虚拟，是指用户不再需要拥有实际的长途数据线路，而是使用Internet公众数据网络的长途数据线路。<br />1.2 OpenVPN的功能<br />可以将两个不同的网段打通一条通道，可以互相访问，对于运维人员来说主要是为了安全，因为OpenVPNssl加密机制，增加了密码的安全度，运维人员可以自定义ip段进行管理服务器，简单点说，安全方便。</p> 
           <h4><a name="_Toc333079240"></a>1.3 SSL VPN原理</h4> 
           <p><span style="font-size: 13px">如果把SSL&nbsp;和VPN&nbsp;两个概念分开，大家对他们的含义应该都非常清楚，但是作为一种新技术，它们之间是如何结合起来的大家也许还不是很了解。从学术和商业的角度来讲，因为他们代表的含义有所不同，因而常常会被曲解。</span><br /><span style="font-size: 13px">&nbsp; &nbsp; &nbsp;SSL（安全套接层）协议是一种在Internet上保证发送信息安全的通用协议。它处于应用层。SSL用公钥加密通过SSL连接传输的数据来工作。&nbsp;SSL协议指定了在应用程序协议（如HTTP、Telnet和FTP等）和&nbsp;TCP/IP协议之间进行数据交换的安全机制，为TCP/IP连接提供数据加密、服务器认证以及可选的客户机认证。SSL协议包括握手协议、记录协议以及警告协议三部分。握手协议负责确定用于客户机和服务器之间的会话加密参数。记录协议用于交换应用数据。警告协议用于在发生错误时终止两个主机之间的会话。</span><br /><span style="font-size: 13px">&nbsp; &nbsp; &nbsp;VPN（虚拟专用网）则主要应用于虚拟连接网络，它可以确保数据的机密性并且具有一定的访问控制功能。VPN是一项非常实用的技术，它可以扩展企业的内部网络，允许企业的员工、客户以及合作伙伴利用Internet访问企业网，而成本远远低于传统的专线接入。过去，VPN&nbsp;总是和IPSec&nbsp;联系在一起，因为它是VPN&nbsp;加密信息实际用到的协议。IPSec&nbsp;运行于网络层，IPSec VPN&nbsp;则多用于连接两个网络或点到点之间的连接。</span></p> 
           <p><span style="font-size: 13px">所谓的SSL VPN，其实是VPN设备厂商为了与IPsec VPN区别所创造出来的名词，指的是使用者利用浏览器内建的SecureSocket Layer封包处理功能，用浏览器连回公司内部SSL VPN服务器，然后透过网络封包转向的方式，让使用者可以在远程计算机执行应用程序，读取公司内部服务器数据。它采用标准的安全套接层（SSL）对传输中的数据包进行加密，从而在应用层保护了数据的安全性。高质量的SSL VPN解决方案可保证企业进行安全的全局访问。在不断扩展的互联网Web站点之间、远程办公室、传统交易大厅和客户端间，SSL VPN克服了IPSec VPN的不足，用户可以轻松实现安全易用、无需客户端安装且配置简单的远程访问，从而降低用户的总成本并增加远程用户的工作效率。而同样在这些地方，设置传统的IPSec VPN非常困难，甚至是不可能的，这是由于必须更改网络地址转换（NAT）和防火墙设置。</span></p> 
           <h4><a name="_Toc333079241"></a>1.4验证LINUX是否支持安装VPN</h4> 
           <p><span style="font-size: 13px">如果购买的vps是基于OpenVZ类型，无法配置标准的VPN(无测试过),部分手机可能无法支持,但OpenVZ支持pptp和openVPN</span></p> 
           <p><span style="font-size: 13px">在安装之前请确认一下你购买的vps是否开启了tun/tap的支持，burst vps默认是不开启tun/tap的，可以使用cat /dev/net/tun&nbsp;进行检查</span></p> 
           <p><span style="font-size: 13px">如果是没有权限的话可以发个ticket要求客服为你开启tun/tap</span></p> 
           <div class="cnblogs_code"> 
            <pre># <span style="color: #0000ff">cat</span> /dev/net/<span style="color: #000000">tun

# </span><span style="color: #0000ff">cat</span> /dev/net/tun:Permissiondenied(未开启tun/<span style="color: #000000">tap)

出现File descriptor </span><span style="color: #0000ff">in</span> bad state说明tun/<span style="color: #000000">tap已经开启，可以开始进行openVPN的安装配置

# </span><span style="color: #0000ff">cat</span> /dev/net/<span style="color: #000000">tun

# </span><span style="color: #0000ff">cat</span>:/dev/net/tun:Filedescriptor <span style="color: #0000ff">in</span> bad state</pre> 
           </div> 
           <p>&nbsp;</p> 
           <p><img src="http://images2015.cnblogs.com/blog/693552/201703/693552-20170315144446026-1431827855.png" alt="" /></p> 
           <h4>一、安装依赖&nbsp;下载软件包</h4> 
           <div class="cnblogs_code"> 
            <pre><span style="color: #008080">1</span> <span style="color: #0000ff">yum</span> <span style="color: #0000ff">install</span> openssl-<span style="color: #000000">devel
</span><span style="color: #008080">2</span> <span style="color: #0000ff">wget</span> http:<span style="color: #008000">//</span><span style="color: #008000">www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz</span>
<span style="color: #008080">3</span> <span style="color: #0000ff">wget</span> http:<span style="color: #008000">//</span><span style="color: #008000">swupdate.openvpn.org/community/releases/openvpn-2.2.1.tar.gz</span></pre> 
           </div> 
           <h4>二、解压及安装</h4> 
           <div> 
            <div class="cnblogs_code"> 
             <pre><span style="color: #008080"> 1</span> # <span style="color: #0000ff">tar</span> xvf lzo-<span style="color: #800080">2.10</span>.<span style="color: #0000ff">tar</span><span style="color: #000000">.gz
</span><span style="color: #008080"> 2</span> # cd lzo-<span style="color: #800080">2.04</span>
<span style="color: #008080"> 3</span> # ./<span style="color: #000000">configure
</span><span style="color: #008080"> 4</span> # <span style="color: #0000ff">make</span> &amp;&amp; <span style="color: #0000ff">make</span> <span style="color: #0000ff">install</span>
<span style="color: #008080"> 5</span> # cd ../
<span style="color: #008080"> 6</span>  
<span style="color: #008080"> 7</span> # <span style="color: #0000ff">tar</span> xvf openvpn-<span style="color: #800080">2.2</span>.<span style="color: #800080">1</span>.<span style="color: #0000ff">tar</span><span style="color: #000000">.gz
</span><span style="color: #008080"> 8</span> # cd openvpn-<span style="color: #800080">2.2</span>.<span style="color: #800080">1</span>
<span style="color: #008080"> 9</span> # ./<span style="color: #000000">configure
</span><span style="color: #008080">10</span> # <span style="color: #0000ff">make</span> &amp;&amp; <span style="color: #0000ff">make</span> <span style="color: #0000ff">install</span>
<span style="color: #008080">11</span> # cd ../</pre> 
            </div> 
           </div> 
           <h4>三、服务器端设置：</h4> 
           <div>
            1. 用easy-rsa生成服务器证书客户端证书
           </div> 
           <div> 
            <div class="cnblogs_code"> 
             <pre><span style="color: #008080">1</span> # <span style="color: #0000ff">cp</span> openvpn-<span style="color: #800080">2.2</span>.<span style="color: #800080">1</span>/easy-rsa/<span style="color: #800080">2.0</span> -r /etc/openvpn/
<span style="color: #008080">2</span> # cd /etc/openvpn/
<span style="color: #008080">3</span> # source vars</pre> 
            </div> 
            <p>&nbsp;</p> 
           </div> 
           <div> 
            <div> 
             <div>
              下面这个命令在第一次安装时可以运行，以后在添加客户端时千万别运行，这个命令会清除所有已经生成的证书密钥。
             </div> 
             <div>
              # ./clean-all
             </div> 
             <h4>生成服务器端ca证书</h4> 
             <div> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080"> 1</span> # ./build-<span style="color: #000000">ca
</span><span style="color: #008080"> 2</span> Generating a <span style="color: #800080">1024</span><span style="color: #000000"> bit RSA private key
</span><span style="color: #008080"> 3</span> ............++++++
<span style="color: #008080"> 4</span> ..................++++++
<span style="color: #008080"> 5</span> writing new private key to <span style="color: #800000">'</span><span style="color: #800000">ca.key</span><span style="color: #800000">'</span>
<span style="color: #008080"> 6</span> -----
<span style="color: #008080"> 7</span> <span style="color: #000000">You are about to be asked to enter information that will be incorporated
</span><span style="color: #008080"> 8</span> <span style="color: #000000">into your certificate request.
</span><span style="color: #008080"> 9</span> <span style="color: #000000">What you are about to enter is what is called a Distinguished Name or a DN.
</span><span style="color: #008080">10</span> <span style="color: #000000">There are quite a few fields but you can leave some blank
</span><span style="color: #008080">11</span> <span style="color: #000000">For some fields there will be a default value,
</span><span style="color: #008080">12</span> If you enter <span style="color: #800000">'</span><span style="color: #800000">.</span><span style="color: #800000">'</span><span style="color: #000000">, the field will be left blank.
</span><span style="color: #008080">13</span> -----
<span style="color: #008080">14</span> Country Name (<span style="color: #800080">2</span><span style="color: #000000"> letter code) [CN]:
</span><span style="color: #008080">15</span> <span style="color: #000000">State or Province Name (full name) [SH]:
</span><span style="color: #008080">16</span> <span style="color: #000000">Locality Name (eg, city) [PD]:
</span><span style="color: #008080">17</span> <span style="color: #000000">Organization Name (eg, company) [zyfmaster]:
</span><span style="color: #008080">18</span> <span style="color: #000000">Organizational Unit Name (eg, section) []:zyfmaster
</span><span style="color: #008080">19</span> Common Name (eg, your name or your server<span style="color: #800000">'</span><span style="color: #800000">s hostname) [zyfmaster CA]:server</span>
<span style="color: #008080">20</span> <span style="color: #000000">Name []:
</span><span style="color: #008080">21</span> Email Address [<span style="color: #800080">905407204</span>@qq.com]:</pre> 
              </div> 
             </div> 
            </div> 
            <div> 
             <div> 
              <div> 
               <h4><strong>生成服务器端密钥key与证书</strong></h4> 
               <div>
                后面这个backup-56&nbsp;就是服务器名，可以自定义。
               </div> 
               <div> 
                <div class="cnblogs_code"> 
                 <pre><span style="color: #008080"> 1</span> # ./build-key-server backup-<span style="color: #800080">56</span> 
<span style="color: #008080"> 2</span> Generating a <span style="color: #800080">1024</span><span style="color: #000000"> bit RSA private key
</span><span style="color: #008080"> 3</span> .......................................++++++
<span style="color: #008080"> 4</span> .......++++++
<span style="color: #008080"> 5</span> writing new private key to <span style="color: #800000">'</span><span style="color: #800000">backup-56</span><span style="color: #800000">'</span>
<span style="color: #008080"> 6</span> -----
<span style="color: #008080"> 7</span> <span style="color: #000000">You are about to be asked to enter information that will be incorporated
</span><span style="color: #008080"> 8</span> <span style="color: #000000">into your certificate request.
</span><span style="color: #008080"> 9</span> <span style="color: #000000">What you are about to enter is what is called a Distinguished Name or a DN.
</span><span style="color: #008080">10</span> <span style="color: #000000">There are quite a few fields but you can leave some blank
</span><span style="color: #008080">11</span> <span style="color: #000000">For some fields there will be a default value,
</span><span style="color: #008080">12</span> If you enter <span style="color: #800000">'</span><span style="color: #800000">.</span><span style="color: #800000">'</span><span style="color: #000000">, the field will be left blank.
</span><span style="color: #008080">13</span> -----
<span style="color: #008080">14</span> Country Name (<span style="color: #800080">2</span><span style="color: #000000"> letter code) [CN]:
</span><span style="color: #008080">15</span> <span style="color: #000000">State or Province Name (full name) [SH]:
</span><span style="color: #008080">16</span> <span style="color: #000000">Locality Name (eg, city) [PD]:
</span><span style="color: #008080">17</span> <span style="color: #000000">Organization Name (eg, company) [zyfmaster]:
</span><span style="color: #008080">18</span> <span style="color: #000000">Organizational Unit Name (eg, section) []:zyfmaster
</span><span style="color: #008080">19</span> Common Name (eg, your name or your server<span style="color: #800000">'</span><span style="color: #800000">s hostname) [backup-56]:backup-56</span>
<span style="color: #008080">20</span> <span style="color: #000000">Name []:
</span><span style="color: #008080">21</span> Email Address [<span style="color: #800080">905407204</span><span style="color: #000000">@qq.com]:
</span><span style="color: #008080">22</span>  
<span style="color: #008080">23</span> Please enter the following <span style="color: #800000">'</span><span style="color: #800000">extra</span><span style="color: #800000">'</span><span style="color: #000000"> attributes
</span><span style="color: #008080">24</span> <span style="color: #000000">to be sent with your certificate request
</span><span style="color: #008080">25</span> <span style="color: #000000">A challenge password []:abcd1234
</span><span style="color: #008080">26</span> <span style="color: #000000">An optional company name []:zyfmaster
</span><span style="color: #008080">27</span> Using configuration from /etc/openvpn/<span style="color: #000000">openssl.cnf
</span><span style="color: #008080">28</span> <span style="color: #000000">Check that the request matches the signature
</span><span style="color: #008080">29</span> <span style="color: #000000">Signature ok
</span><span style="color: #008080">30</span> The Subject<span style="color: #800000">'</span><span style="color: #800000">s Distinguished Name is as follows</span>
<span style="color: #008080">31</span> countryName           :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">CN</span><span style="color: #800000">'</span>
<span style="color: #008080">32</span> stateOrProvinceName   :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">SH</span><span style="color: #800000">'</span>
<span style="color: #008080">33</span> localityName          :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">PD</span><span style="color: #800000">'</span>
<span style="color: #008080">34</span> organizationName      :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">zyfmaster</span><span style="color: #800000">'</span>
<span style="color: #008080">35</span> organizationalUnitName:PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">zyfmaster</span><span style="color: #800000">'</span>
<span style="color: #008080">36</span> commonName            :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">server</span><span style="color: #800000">'</span>
<span style="color: #008080">37</span> emailAddress          :IA5STRING:<span style="color: #800000">'</span><span style="color: #800000">905407204@qq.com</span><span style="color: #800000">'</span>
<span style="color: #008080">38</span> Certificate is to be certified <span style="color: #0000ff">until</span> Dec  <span style="color: #800080">2</span> <span style="color: #800080">04</span>:<span style="color: #800080">14</span>:<span style="color: #800080">34</span> <span style="color: #800080">2022</span> GMT (<span style="color: #800080">3650</span><span style="color: #000000"> days)
</span><span style="color: #008080">39</span> Sign the certificate? [y/<span style="color: #000000">n]:y
</span><span style="color: #008080">40</span>  
<span style="color: #008080">41</span>  
<span style="color: #008080">42</span> <span style="color: #800080">1</span> out of <span style="color: #800080">1</span> certificate requests certified, commit? [y/<span style="color: #000000">n]y
</span><span style="color: #008080">43</span> Write out database with <span style="color: #800080">1</span><span style="color: #000000"> new entries
</span><span style="color: #008080">44</span> Data Base Updated</pre> 
                </div> 
               </div> 
              </div> 
              <div>
               命令执行完成后会在keys目录下生成服务端证书与key：backup-56.crt，backup-56.key，backup-56.csr
              </div> 
              <div>
               &nbsp;
              </div> 
              <div>
               <strong>生成客户端 key与证书</strong>
              </div> 
              <div> 
               <div class="cnblogs_code"> 
                <pre><span style="color: #008080"> 1</span> # ./build-<span style="color: #000000">key client1
</span><span style="color: #008080"> 2</span> Generating a <span style="color: #800080">1024</span><span style="color: #000000"> bit RSA private key
</span><span style="color: #008080"> 3</span> ............++++++
<span style="color: #008080"> 4</span> ........................................................++++++
<span style="color: #008080"> 5</span> writing new private key to <span style="color: #800000">'</span><span style="color: #800000">client1.key</span><span style="color: #800000">'</span>
<span style="color: #008080"> 6</span> -----
<span style="color: #008080"> 7</span> <span style="color: #000000">You are about to be asked to enter information that will be incorporated
</span><span style="color: #008080"> 8</span> <span style="color: #000000">into your certificate request.
</span><span style="color: #008080"> 9</span> <span style="color: #000000">What you are about to enter is what is called a Distinguished Name or a DN.
</span><span style="color: #008080">10</span> <span style="color: #000000">There are quite a few fields but you can leave some blank
</span><span style="color: #008080">11</span> <span style="color: #000000">For some fields there will be a default value,
</span><span style="color: #008080">12</span> If you enter <span style="color: #800000">'</span><span style="color: #800000">.</span><span style="color: #800000">'</span><span style="color: #000000">, the field will be left blank.
</span><span style="color: #008080">13</span> -----
<span style="color: #008080">14</span> Country Name (<span style="color: #800080">2</span><span style="color: #000000"> letter code) [CN]:
</span><span style="color: #008080">15</span> <span style="color: #000000">State or Province Name (full name) [SH]:
</span><span style="color: #008080">16</span> <span style="color: #000000">Locality Name (eg, city) [PD]:
</span><span style="color: #008080">17</span> <span style="color: #000000">Organization Name (eg, company) [zyfmaster]:
</span><span style="color: #008080">18</span> <span style="color: #000000">Organizational Unit Name (eg, section) []:zyfmaster
</span><span style="color: #008080">19</span> Common Name (eg, your name or your server<span style="color: #800000">'</span><span style="color: #800000">s hostname) [client1]:client1 #重要: 每个不同的client 生成的证书, 名字必须不同.</span>
<span style="color: #008080">20</span> <span style="color: #000000">Name []:
</span><span style="color: #008080">21</span> Email Address [<span style="color: #800080">905407204</span><span style="color: #000000">@qq.com]:
</span><span style="color: #008080">22</span> 
<span style="color: #008080">23</span> Please enter the following <span style="color: #800000">'</span><span style="color: #800000">extra</span><span style="color: #800000">'</span><span style="color: #000000"> attributes
</span><span style="color: #008080">24</span> <span style="color: #000000">to be sent with your certificate request
</span><span style="color: #008080">25</span> <span style="color: #000000">A challenge password []:abcd1234
</span><span style="color: #008080">26</span> <span style="color: #000000">An optional company name []:zyfmaster
</span><span style="color: #008080">27</span> Using configuration from /etc/openvpn/<span style="color: #000000">openssl.cnf
</span><span style="color: #008080">28</span> <span style="color: #000000">Check that the request matches the signature
</span><span style="color: #008080">29</span> <span style="color: #000000">Signature ok
</span><span style="color: #008080">30</span> The Subject<span style="color: #800000">'</span><span style="color: #800000">s Distinguished Name is as follows</span>
<span style="color: #008080">31</span> countryName           :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">CN</span><span style="color: #800000">'</span>
<span style="color: #008080">32</span> stateOrProvinceName   :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">SH</span><span style="color: #800000">'</span>
<span style="color: #008080">33</span> localityName          :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">PD</span><span style="color: #800000">'</span>
<span style="color: #008080">34</span> organizationName      :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">zyfmaster</span><span style="color: #800000">'</span>
<span style="color: #008080">35</span> organizationalUnitName:PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">zyfmaster</span><span style="color: #800000">'</span>
<span style="color: #008080">36</span> commonName            :PRINTABLE:<span style="color: #800000">'</span><span style="color: #800000">client1</span><span style="color: #800000">'</span>
<span style="color: #008080">37</span> emailAddress          :IA5STRING:<span style="color: #800000">'</span><span style="color: #800000">905407204@qq.com</span><span style="color: #800000">'</span>
<span style="color: #008080">38</span> Certificate is to be certified <span style="color: #0000ff">until</span> Dec  <span style="color: #800080">2</span> <span style="color: #800080">04</span>:<span style="color: #800080">15</span>:<span style="color: #800080">50</span> <span style="color: #800080">2022</span> GMT (<span style="color: #800080">3650</span><span style="color: #000000"> days)
</span><span style="color: #008080">39</span> Sign the certificate? [y/<span style="color: #000000">n]:y
</span><span style="color: #008080">40</span> 
<span style="color: #008080">41</span> 
<span style="color: #008080">42</span> <span style="color: #800080">1</span> out of <span style="color: #800080">1</span> certificate requests certified, commit? [y/<span style="color: #000000">n]y
</span><span style="color: #008080">43</span> Write out database with <span style="color: #800080">1</span><span style="color: #000000"> new entries
</span><span style="color: #008080">44</span> Data Base Updated</pre> 
               </div> 
               <div>
                以此类推建立其他客户端 key
               </div> 
               <div> 
                <div class="cnblogs_code"> 
                 <pre><span style="color: #008080">1</span> # ./build-<span style="color: #000000">key client2
</span><span style="color: #008080">2</span> # ./build-key client3</pre> 
                </div> 
                <p><span style="line-height: 1.5">注意在输入&nbsp;Common Name (eg, your name or your server’s hostname) []: 的输入时, 每个证书输入的名字必须不同.</span></p> 
               </div> 
               <div>
                &nbsp;
               </div> 
               <h4>5.生成Diffie Hellman参数</h4> 
               <div class="cnblogs_code"> 
                <pre><span style="color: #008080">1</span> # ./build-<span style="color: #000000">dh 
</span><span style="color: #008080">2</span> Generating DH parameters, <span style="color: #800080">1024</span> bit <span style="color: #0000ff">long</span> safe prime, generator <span style="color: #800080">2</span>
<span style="color: #008080">3</span> This is going to take a <span style="color: #0000ff">long</span> <span style="color: #0000ff">time</span>
<span style="color: #008080">4</span> ...........................+...................................................................+.................................................+.............................+...............+................................................................................................+............................+...+.............................................................................................................................................+.....................................+........................+.....................................................................................................+..........................................+...........................................................................................................................+............................+.............+...........+..+...........................+..........................+.++*++*++*</pre> 
               </div> 
               <h4>6.将 keys 下的所有文件打包下载到本地</h4> 
               <p># tar zcvf yskeys.tar.gz keys/*</p> 
               <h4>7.创建服务端配置文件</h4> 
              </div> 
             </div> 
             <div> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080">1</span> # <span style="color: #0000ff">mkdir</span> /etc/openvpn/<span style="color: #800080">2.0</span>/<span style="color: #000000">conf
</span><span style="color: #008080">2</span> # <span style="color: #0000ff">cp</span> /root/openvpn/openvpn-<span style="color: #800080">2.2</span>.<span style="color: #800080">1</span>/sample-config-files/server.conf /etc/openvpn/conf/
<span style="color: #008080">3</span> # vim /etc/openvpn/conf/server.conf</pre> 
              </div> 
              <p>server.conf内容</p> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080"> 1</span> port <span style="color: #800080">1723</span>
<span style="color: #008080"> 2</span> <span style="color: #000000">proto tcp
</span><span style="color: #008080"> 3</span> <span style="color: #000000">dev tun
</span><span style="color: #008080"> 4</span> ca /etc/openvpn/keys/<span style="color: #000000">ca.crt
</span><span style="color: #008080"> 5</span> cert /etc/openvpn/keys/backup-<span style="color: #800080">56</span><span style="color: #000000">.crt
</span><span style="color: #008080"> 6</span> dh /etc/openvpn/keys/<span style="color: #000000">dh1024.pem
</span><span style="color: #008080"> 7</span> server <span style="color: #800080">10.8</span>.<span style="color: #800080">0.0</span> <span style="color: #800080">255.255</span>.<span style="color: #800080">255.0</span>
<span style="color: #008080"> 8</span> <span style="color: #0000ff">ifconfig</span>-pool-<span style="color: #000000">persist ipp.txt
</span><span style="color: #008080"> 9</span> push <span style="color: #800000">&quot;</span><span style="color: #800000">route 10.8.0.0 255.255.255.0</span><span style="color: #800000">&quot;</span>
<span style="color: #008080">10</span> push <span style="color: #800000">&quot;</span><span style="color: #800000">route 0.0.0.0 0.0.0.0</span><span style="color: #800000">&quot;</span>
<span style="color: #008080">11</span> push <span style="color: #800000">&quot;</span><span style="color: #800000">redirect-gateway def1 bypass-dhcp</span><span style="color: #800000">&quot;</span>
<span style="color: #008080">12</span> push <span style="color: #800000">&quot;</span><span style="color: #800000">dhcp-option DNS 223.5.5.5</span><span style="color: #800000">&quot;</span>
<span style="color: #008080">13</span> push <span style="color: #800000">&quot;</span><span style="color: #800000">dhcp-option DNS 114.114.114.114</span><span style="color: #800000">&quot;</span>
<span style="color: #008080">14</span> client-to-<span style="color: #000000">client
</span><span style="color: #008080">15</span> keepalive <span style="color: #800080">10</span> <span style="color: #800080">120</span>
<span style="color: #008080">16</span> comp-<span style="color: #000000">lzo
</span><span style="color: #008080">17</span> <span style="color: #000000">user nobody
</span><span style="color: #008080">18</span> <span style="color: #000000">group nobody
</span><span style="color: #008080">19</span> persist-<span style="color: #000000">key
</span><span style="color: #008080">20</span> persist-<span style="color: #000000">tun
</span><span style="color: #008080">21</span> status openvpn-<span style="color: #000000">status.log
</span><span style="color: #008080">22</span> verb <span style="color: #800080">3</span></pre> 
              </div> 
              <h4>四、打开服务器的路由功能</h4> 
              <div> 
               <div>
                1.开启CentOS 5 的路由转发功能
               </div> 
               <div>
                # vim /etc/sysctl.conf
               </div> 
               <div>
                修改以下内容：
               </div> 
               <div>
                net.ipv4.ip_forward = 1
               </div> 
              </div> 
              <div>
               &nbsp;
              </div> 
              <h4><span style="font-size: 1em; line-height: 1.5">五、使sysctl.conf配置文件生效并添加iptables转发规则：</span></h4> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080">1</span> <span style="color: #000000"># sysctl Cp
</span><span style="color: #008080">2</span> # iptables -t nat -A POSTROUTING -o eth0 -s <span style="color: #800080">10.8</span>.<span style="color: #800080">0.0</span>/<span style="color: #800080">24</span> -<span style="color: #000000">j MASQUERADE
</span><span style="color: #008080">3</span> # /etc/init.d/iptables save</pre> 
              </div> 
              <p><strong>注：参见iptables的被转发的包的nat表POSTROUTING链，在这里是做SNAT（源地址转换）。如果没加上这条规则，就算从openvpn客户端是可以经过openvpn服务端访问到另一个网段的机器，那台机器的返回包由于是返回给客户端内网段ip，这样包就返回不到openvpn服务器再到openvpn客户端了。</strong></p> 
              <p><strong>如果服务器有两块网卡,一块内网一块外网.内网设置的是192.168.1.0/24网段.则还需要加一条路由才可以访问内网网段.</strong></p> 
             </div> 
             <div> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080">1</span> iptables -t nat -A POSTROUTING -o eth1 -s <span style="color: #800080">10.8</span>.<span style="color: #800080">0.0</span>/<span style="color: #800080">24</span> -d <span style="color: #800080">192.168</span>.<span style="color: #800080">1.0</span>/<span style="color: #800080">24</span> -j MASQUERADE</pre> 
              </div> 
              <h4>六、启动openvpn，并加入随机启动</h4> 
             </div> 
             <div> 
              <div class="cnblogs_code"> 
               <pre><span style="color: #008080">1</span> <span style="color: #0000ff">vi</span> /etc/<span style="color: #000000">rc.local
</span><span style="color: #008080">2</span> <span style="color: #000000">然后在最后面加入此行:
</span><span style="color: #008080">3</span> /usr/local/sbin/openvpn --config /etc/openvpn/conf/server.conf --daemon</pre> 
              </div> 
              <h4>服务端到此配置完成.</h4> 
             </div> 
             <h4>七、OpenVPN GUI For Windows 客户端安装过程</h4> 
             <div> 
              <div>
               1.下载 openvpn-2.1_rc15-install.exe(此版本集成 OpenVPN GUI)官方下载地址:http://openvpn.net/release/openvpn-2.1_rc15-install.exe
              </div> 
              <div>
               2.依屏幕指示安装OpenVPN GUI
              </div> 
              <div>
               3.配置 openvpn gui
              </div> 
              <div>
               将上面第6步打包的yskeys.tar.gz中的下列证书文件解压到 你的OpenVPN GUI安装路径OpenVPN/config文件夹下
              </div> 
              <div>
               ca.crt
              </div> 
              <div>
               ca.key
              </div> 
              <div>
               client1.crt
              </div> 
              <div>
               client1.csr
              </div> 
              <div>
               client1.key
              </div> 
              <div>
               &nbsp;
              </div> 
              <div>
               4.修改client.ovpn
              </div> 
              <div>
               把你的OpenVPN GUI安装路径OpenVPN/sample-config下的client.ovpn文件复制到你的OpenVPN GUI安装路径OpenVPN/config文件夹下,用记事本打开client.ovpn
              </div> 
              <div>
               #找到remote my-server-1 1194,把my-server-1改成你的ip地址
              </div> 
              <div>
               remote a.b.c.d (自己的VPN地址)
              </div> 
              <div>
               #找到ca\cert\key
              </div> 
              <div>
               后面的文件名修改为对应的key的名字
              </div> 
              <div>
               如:
              </div> 
              <div>
               ca ca.crt
              </div> 
              <div>
               cert client1.crt
              </div> 
              <div>
               <em id="__mceDel" style="line-height: 1.5"><em id="__mceDel"><em id="__mceDel">key client1.key</em></em></em>
              </div> 
              <div>
               &nbsp;
              </div> 
              <div>
               <em>我的配置文件示例:</em>
              </div> 
              <div> 
               <div class="cnblogs_code">
                <img id="code_img_closed_1c9a8b92-9435-4cbe-95f1-f7da0a5b0b6c" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" />
                <img id="code_img_opened_1c9a8b92-9435-4cbe-95f1-f7da0a5b0b6c" class="code_img_opened" style="display: none" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" /> 
                <div id="cnblogs_code_open_1c9a8b92-9435-4cbe-95f1-f7da0a5b0b6c" class="cnblogs_code_hide"> 
                 <pre><span style="color: #008080">  1</span> <span style="color: #000000">##############################################
</span><span style="color: #008080">  2</span> # Sample client-side OpenVPN <span style="color: #800080">2.0</span> config <span style="color: #0000ff">file</span><span style="color: #000000"> #
</span><span style="color: #008080">  3</span> # <span style="color: #0000ff">for</span> connecting to multi-<span style="color: #000000">client server.     #
</span><span style="color: #008080">  4</span> <span style="color: #000000">#                                            #
</span><span style="color: #008080">  5</span> <span style="color: #000000"># This configuration can be used by multiple #
</span><span style="color: #008080">  6</span> <span style="color: #000000"># clients, however each client should have   #
</span><span style="color: #008080">  7</span> <span style="color: #000000"># its own cert and key files.                #
</span><span style="color: #008080">  8</span> <span style="color: #000000">#                                            #
</span><span style="color: #008080">  9</span> <span style="color: #000000"># On Windows, you might want to rename this  #
</span><span style="color: #008080"> 10</span> # <span style="color: #0000ff">file</span><span style="color: #000000"> so it has a .ovpn extension           #
</span><span style="color: #008080"> 11</span> <span style="color: #000000">##############################################
</span><span style="color: #008080"> 12</span> 
<span style="color: #008080"> 13</span> <span style="color: #000000"># Specify that we are a client and that we
</span><span style="color: #008080"> 14</span> # will be pulling certain config <span style="color: #0000ff">file</span><span style="color: #000000"> directives
</span><span style="color: #008080"> 15</span> <span style="color: #000000"># from the server.
</span><span style="color: #008080"> 16</span> <span style="color: #000000">client
</span><span style="color: #008080"> 17</span> 
<span style="color: #008080"> 18</span> <span style="color: #000000"># Use the same setting as you are using on
</span><span style="color: #008080"> 19</span> <span style="color: #000000"># the server.
</span><span style="color: #008080"> 20</span> # On most systems, the VPN will not <span style="color: #0000ff">function</span>
<span style="color: #008080"> 21</span> <span style="color: #000000"># unless you partially or fully disable
</span><span style="color: #008080"> 22</span> # the firewall <span style="color: #0000ff">for</span> the TUN/<span style="color: #000000">TAP interface.
</span><span style="color: #008080"> 23</span> <span style="color: #000000">;dev tap
</span><span style="color: #008080"> 24</span> <span style="color: #000000">dev tun
</span><span style="color: #008080"> 25</span> 
<span style="color: #008080"> 26</span> # Windows needs the TAP-<span style="color: #000000">Win32 adapter name
</span><span style="color: #008080"> 27</span> <span style="color: #000000"># from the Network Connections panel
</span><span style="color: #008080"> 28</span> # <span style="color: #0000ff">if</span> you have <span style="color: #0000ff">more</span><span style="color: #000000"> than one.  On XP SP2,
</span><span style="color: #008080"> 29</span> <span style="color: #000000"># you may need to disable the firewall
</span><span style="color: #008080"> 30</span> # <span style="color: #0000ff">for</span><span style="color: #000000"> the TAP adapter.
</span><span style="color: #008080"> 31</span> ;dev-<span style="color: #000000">node MyTap
</span><span style="color: #008080"> 32</span> 
<span style="color: #008080"> 33</span> <span style="color: #000000"># Are we connecting to a TCP or
</span><span style="color: #008080"> 34</span> # UDP server?<span style="color: #000000">  Use the same setting as
</span><span style="color: #008080"> 35</span> <span style="color: #000000"># on the server.
</span><span style="color: #008080"> 36</span> <span style="color: #000000">proto tcp
</span><span style="color: #008080"> 37</span> <span style="color: #000000">;proto udp
</span><span style="color: #008080"> 38</span> 
<span style="color: #008080"> 39</span> # The <span style="color: #0000ff">hostname</span>/<span style="color: #000000">IP and port of the server.
</span><span style="color: #008080"> 40</span> <span style="color: #000000"># You can have multiple remote entries
</span><span style="color: #008080"> 41</span> <span style="color: #000000"># to load balance between the servers.
</span><span style="color: #008080"> 42</span> remote <span style="color: #800080">115.182</span>.<span style="color: #800080">68.56</span> <span style="color: #800080">1723</span>
<span style="color: #008080"> 43</span> ;remote my-server-<span style="color: #800080">2</span> <span style="color: #800080">1194</span>
<span style="color: #008080"> 44</span> 
<span style="color: #008080"> 45</span> <span style="color: #000000"># Choose a random host from the remote
</span><span style="color: #008080"> 46</span> # list <span style="color: #0000ff">for</span> load-<span style="color: #000000">balancing.  Otherwise
</span><span style="color: #008080"> 47</span> # try hosts <span style="color: #0000ff">in</span><span style="color: #000000"> the order specified.
</span><span style="color: #008080"> 48</span> ;remote-<span style="color: #000000">random
</span><span style="color: #008080"> 49</span> 
<span style="color: #008080"> 50</span> <span style="color: #000000"># Keep trying indefinitely to resolve the
</span><span style="color: #008080"> 51</span> <span style="color: #000000"># host name of the OpenVPN server.  Very useful
</span><span style="color: #008080"> 52</span> # on machines <span style="color: #0000ff">which</span><span style="color: #000000"> are not permanently connected
</span><span style="color: #008080"> 53</span> <span style="color: #000000"># to the internet such as laptops.
</span><span style="color: #008080"> 54</span> resolv-<span style="color: #000000">retry infinite
</span><span style="color: #008080"> 55</span> 
<span style="color: #008080"> 56</span> # Most clients don<span style="color: #800000">'</span><span style="color: #800000">t need to bind to</span>
<span style="color: #008080"> 57</span> <span style="color: #000000"># a specific local port number.
</span><span style="color: #008080"> 58</span> <span style="color: #000000">nobind
</span><span style="color: #008080"> 59</span> 
<span style="color: #008080"> 60</span> # Downgrade privileges after initialization (non-<span style="color: #000000">Windows only)
</span><span style="color: #008080"> 61</span> <span style="color: #000000">;user nobody
</span><span style="color: #008080"> 62</span> <span style="color: #000000">;group nobody
</span><span style="color: #008080"> 63</span> 
<span style="color: #008080"> 64</span> <span style="color: #000000"># Try to preserve some state across restarts.
</span><span style="color: #008080"> 65</span> persist-<span style="color: #000000">key
</span><span style="color: #008080"> 66</span> persist-<span style="color: #000000">tun
</span><span style="color: #008080"> 67</span> 
<span style="color: #008080"> 68</span> <span style="color: #000000"># If you are connecting through an
</span><span style="color: #008080"> 69</span> <span style="color: #000000"># HTTP proxy to reach the actual OpenVPN
</span><span style="color: #008080"> 70</span> # server, put the proxy server/<span style="color: #000000">IP and
</span><span style="color: #008080"> 71</span> # port number here.  See the <span style="color: #0000ff">man</span><span style="color: #000000"> page
</span><span style="color: #008080"> 72</span> # <span style="color: #0000ff">if</span><span style="color: #000000"> your proxy server requires
</span><span style="color: #008080"> 73</span> <span style="color: #000000"># authentication.
</span><span style="color: #008080"> 74</span> ;http-proxy-<span style="color: #000000">retry # retry on connection failures
</span><span style="color: #008080"> 75</span> ;http-<span style="color: #000000">proxy [proxy server] [proxy port #]
</span><span style="color: #008080"> 76</span> 
<span style="color: #008080"> 77</span> <span style="color: #000000"># Wireless networks often produce a lot
</span><span style="color: #008080"> 78</span> <span style="color: #000000"># of duplicate packets.  Set this flag
</span><span style="color: #008080"> 79</span> <span style="color: #000000"># to silence duplicate packet warnings.
</span><span style="color: #008080"> 80</span> ;mute-replay-<span style="color: #000000">warnings
</span><span style="color: #008080"> 81</span> 
<span style="color: #008080"> 82</span> # SSL/<span style="color: #000000">TLS parms.
</span><span style="color: #008080"> 83</span> # See the server config <span style="color: #0000ff">file</span> <span style="color: #0000ff">for</span> <span style="color: #0000ff">more</span>
<span style="color: #008080"> 84</span> # description.  It<span style="color: #800000">'</span><span style="color: #800000">s best to use</span>
<span style="color: #008080"> 85</span> # a separate .crt/.key <span style="color: #0000ff">file</span><span style="color: #000000"> pair
</span><span style="color: #008080"> 86</span> # <span style="color: #0000ff">for</span><span style="color: #000000"> each client.  A single ca
</span><span style="color: #008080"> 87</span> # <span style="color: #0000ff">file</span> can be used <span style="color: #0000ff">for</span><span style="color: #000000"> all clients.
</span><span style="color: #008080"> 88</span> <span style="color: #000000">ca ca.crt
</span><span style="color: #008080"> 89</span> <span style="color: #000000">cert client1.crt
</span><span style="color: #008080"> 90</span> <span style="color: #000000">key client1.key
</span><span style="color: #008080"> 91</span> 
<span style="color: #008080"> 92</span> <span style="color: #000000"># Verify server certificate by checking
</span><span style="color: #008080"> 93</span> <span style="color: #000000"># that the certicate has the nsCertType
</span><span style="color: #008080"> 94</span> # field set to <span style="color: #800000">&quot;</span><span style="color: #800000">server</span><span style="color: #800000">&quot;</span><span style="color: #000000">.  This is an
</span><span style="color: #008080"> 95</span> <span style="color: #000000"># important precaution to protect against
</span><span style="color: #008080"> 96</span> <span style="color: #000000"># a potential attack discussed here:
</span><span style="color: #008080"> 97</span> #  http:<span style="color: #008000">//</span><span style="color: #008000">openvpn.net/howto.html#mitm</span>
<span style="color: #008080"> 98</span> <span style="color: #000000">#
</span><span style="color: #008080"> 99</span> <span style="color: #000000"># To use this feature, you will need to generate
</span><span style="color: #008080">100</span> <span style="color: #000000"># your server certificates with the nsCertType
</span><span style="color: #008080">101</span> # field set to <span style="color: #800000">&quot;</span><span style="color: #800000">server</span><span style="color: #800000">&quot;</span>.  The build-key-<span style="color: #000000">server
</span><span style="color: #008080">102</span> # script <span style="color: #0000ff">in</span> the easy-rsa folder will <span style="color: #0000ff">do</span><span style="color: #000000"> this.
</span><span style="color: #008080">103</span> ;ns-cert-<span style="color: #000000">type server
</span><span style="color: #008080">104</span> 
<span style="color: #008080">105</span> # If a tls-<span style="color: #000000">auth key is used on the server
</span><span style="color: #008080">106</span> # <span style="color: #0000ff">then</span><span style="color: #000000"> every client must also have the key.
</span><span style="color: #008080">107</span> ;tls-auth ta.key <span style="color: #800080">1</span>
<span style="color: #008080">108</span> 
<span style="color: #008080">109</span> <span style="color: #000000"># Select a cryptographic cipher.
</span><span style="color: #008080">110</span> <span style="color: #000000"># If the cipher option is used on the server
</span><span style="color: #008080">111</span> # <span style="color: #0000ff">then</span><span style="color: #000000"> you must also specify it here.
</span><span style="color: #008080">112</span> <span style="color: #000000">;cipher x
</span><span style="color: #008080">113</span> 
<span style="color: #008080">114</span> <span style="color: #000000"># Enable compression on the VPN link.
</span><span style="color: #008080">115</span> # Don<span style="color: #800000">'</span><span style="color: #800000">t enable this unless it is also</span>
<span style="color: #008080">116</span> # enabled <span style="color: #0000ff">in</span> the server config <span style="color: #0000ff">file</span><span style="color: #000000">.
</span><span style="color: #008080">117</span> comp-<span style="color: #000000">lzo
</span><span style="color: #008080">118</span> 
<span style="color: #008080">119</span> # Set log <span style="color: #0000ff">file</span><span style="color: #000000"> verbosity.
</span><span style="color: #008080">120</span> verb <span style="color: #800080">3</span>
<span style="color: #008080">121</span> 
<span style="color: #008080">122</span> <span style="color: #000000"># Silence repeating messages
</span><span style="color: #008080">123</span> ;mute <span style="color: #800080">20</span></pre> 
                </div> 
                <span class="cnblogs_code_collapse">客户端配置文件</span>
               </div> 
               <p>&nbsp;</p> 
              </div> 
              <div>
               5.双击 client.ovpn 即可启动 openvpn, 或者通过 OpenVPN GUI 的控制启动 VPN.
              </div> 
             </div> 
             <div>
              &nbsp;
             </div> 
             <div>
              弹出的窗口最后出现这一行说明拨号成功了.
             </div> 
             <div>
              Wed Mar 15 16:59:07 2017 Successful ARP Flush on interface [16]
             </div> 
             <div>
              &nbsp;
             </div> 
             <div>
              &nbsp;
             </div> 
             <div>
              &nbsp;
             </div> 
            </div> 
           </div>
          </div>
          <div id="MySignature"></div> 
          <div class="clear"></div> 
          <div id="blog_post_info_block"> 
           <div id="BlogPostCategory"></div> 
           <div id="EntryTag"></div> 
           <div id="blog_post_info"> 
           </div> 
           <div class="clear"></div> 
           <div id="post_next_prev"></div> 
          </div> 
         </div> 
         <div class="postDesc">
          posted @ 
          <span id="post-date">2017-03-16 10:31</span> 
          <a href="http://www.cnblogs.com/wayde-Z/">Wayde-p</a> 阅读(
          <span id="post_view_count">...</span>) 评论(
          <span id="post_comment_count">...</span>) 
          <a href="https://i.cnblogs.com/EditPosts.aspx?postid=6558159" rel="nofollow">编辑</a> 
          <a href="#" onclick="AddToWz(6558159);return false;">收藏</a>
         </div> 
        </div> 
        <script type="text/javascript">var allowComments=true,cb_blogId=309827,cb_entryId=6558159,cb_blogApp=currentBlogApp,cb_blogUserGuid='f001ea50-246e-e411-b908-9dcfd8948a71',cb_entryCreatedDate='2017/3/16 10:31:00';loadViewCount(cb_entryId);</script> 
       </div>
       <!--end: topics 文章、评论容器--> 
      </div>
      <a name="!comments"></a>
      <div id="blog-comments-placeholder"></div>
      <script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script> 
      <div id="comment_form" class="commentform"> 
       <a name="commentform"></a> 
       <div id="divCommentShow"></div> 
       <div id="comment_nav">
        <span id="span_refresh_tips"></span>
        <a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a>
        <a href="#" onclick="return RefreshPage();">刷新页面</a>
        <a href="#top">返回顶部</a>
       </div> 
       <div id="comment_form_container"></div> 
       <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div> 
       <div id="ad_t2"></div> 
       <div id="opt_under_post"></div> 
       <div id="ad_c1" class="c_ad_block"></div> 
       <div id="under_post_news"></div> 
       <div id="ad_c2" class="c_ad_block"></div> 
       <div id="under_post_kb"></div> 
       <div id="HistoryToday" class="c_ad_block"></div> 
       <script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script> 
      </div> 
     </div>
     <!--end: forFlow --> 
    </div>
    <!--end: mainContent 主体内容容器--> 
    <div id="sideBar"> 
     <div id="sideBarMain"> 
      <!--done--> 
      <div class="newsItem"> 
       <h3 class="catListTitle">公告</h3> 
       <div id="blog-news"></div>
       <script type="text/javascript">loadBlogNews();</script> 
      </div> 
      <div id="blog-calendar" style="display:none"></div>
      <script type="text/javascript">loadBlogDefaultCalendar();</script> 
      <div id="leftcontentcontainer"> 
       <div id="blog-sidecolumn"></div>
       <script type="text/javascript">loadBlogSideColumn();</script> 
      </div> 
     </div>
     <!--end: sideBarMain --> 
    </div>
    <!--end: sideBar 侧边栏容器 --> 
    <div class="clear"></div> 
   </div>
   <!--end: main --> 
   <div class="clear"></div> 
   <div id="footer"> 
    <!--done--> Copyright &copy;2017 Wayde-p 
   </div>
   <!--end: footer --> 
  </div>
  <!--end: home 自定义的最大容器 -->   
 </body>
</html>